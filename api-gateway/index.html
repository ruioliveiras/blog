<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=edge"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><link href="https://fonts.gstatic.com" rel="preconnect" crossOrigin="anonymous"/><link rel="preload" href="/component---src-layouts-index-js-346be2a9e8553dce1ede.js" as="script"/><link rel="preload" href="/component---src-templates-blog-post-js-7e8d1359823ed094ecb5.js" as="script"/><link rel="preload" href="/path---api-gateway-2f381926b7bf16baf43b.js" as="script"/><link rel="preload" href="/app-117f37bcb7fa0dee84f0.js" as="script"/><link rel="preload" href="/commons-39aa834b3ef8ab6ea859.js" as="script"/><style type="text/css" data-styled-components="kKvztC lisfJs imEtRc eTzlhe jpQFXF iuAhMc fjcXyM clHDjp gTXDNM fYeLTY jhBgmt fSEAnG hpPTKp dqfGXQ iwNQwu gDhWkp krhCRj fwtlwV SZdRx jCCrki kulSxP infYH" data-styled-components-is-local="true">/* sc-component-id: sc-bdVaJa */

.jhBgmt{position:absolute;top:15vh;right:0;left:0;margin:0 auto;max-width:840px;z-index:2;}@media only screen and (min-width:768px){.jhBgmt{top:25vh;}}
/* sc-component-id: sc-bwzfXH */

.kulSxP{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;}
/* sc-component-id: sc-htpNat */

.infYH{display:inline-block;-webkit-text-decoration:none;text-decoration:none;color:rgba(255,255,255,0.6);-webkit-transition:color 175ms ease-in-out,-webkit-transform 175ms ease-in-out;-webkit-transition:color 175ms ease-in-out,transform 175ms ease-in-out;transition:color 175ms ease-in-out,transform 175ms ease-in-out;}.infYH:hover{-webkit-transform:scale(1.1);-ms-transform:scale(1.1);transform:scale(1.1);color:rgba(255,255,255,1);}
/* sc-component-id: sc-bxivhb */

.jCCrki{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:justify;-webkit-justify-content:space-between;-ms-flex-pack:justify;justify-content:space-between;width:240px;}.jCCrki .button{margin:0.5rem 0;}
/* sc-component-id: sc-ifAKCX */

.SZdRx{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;padding:1rem 0.5rem;}
/* sc-component-id: sc-EHOje */

.gDhWkp{position:absolute;top:0;background-color:transparent;color:white;-webkit-text-decoration:none;text-decoration:none;padding:0 0.75rem;height:2.25rem;line-height:44px;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:space-around;-webkit-justify-content:space-around;-ms-flex-pack:space-around;justify-content:space-around;-webkit-transition:all 125ms ease-in-out;transition:all 125ms ease-in-out;text-transform:uppercase;font-family:sans-serif;font-size:0.75rem;z-index:2;}.gDhWkp:hover{background-color:white;color:hsl(17,90%,20%);}.wf-active .gDhWkp{font-family:'Montserrat',sans-serif;}.gDhWkp .content{display:none;padding:0 0.375rem;}.gDhWkp .icon{font-size:1.125rem;}@media only screen and (min-width:768px){.gDhWkp .content{display:inline-block;white-space:nowrap;}}
/* sc-component-id: sc-gzVnrw */

.iwNQwu{left:0;}
/* sc-component-id: sc-keyframes-kKvztC */
@-webkit-keyframes kKvztC{0%{background-position:50% 0%;}50%{background-position:51% 100%;}100%{background-position:50% 0%;}}@keyframes kKvztC{0%{background-position:50% 0%;}50%{background-position:51% 100%;}100%{background-position:50% 0%;}}
/* sc-component-id: sc-keyframes-lisfJs */
@-webkit-keyframes lisfJs{10%,90%{-webkit-transform:translate3d(-1px,0,0) rotate(5deg);-ms-transform:translate3d(-1px,0,0) rotate(5deg);transform:translate3d(-1px,0,0) rotate(5deg);}20%,80%{-webkit-transform:translate3d(2px,0,0);-ms-transform:translate3d(2px,0,0);transform:translate3d(2px,0,0);}30%,50%,70%{-webkit-transform:translate3d(-2px,0,0) rotate(-5deg);-ms-transform:translate3d(-2px,0,0) rotate(-5deg);transform:translate3d(-2px,0,0) rotate(-5deg);}40%,60%{-webkit-transform:translate3d(2px,0,0);-ms-transform:translate3d(2px,0,0);transform:translate3d(2px,0,0);}}@keyframes lisfJs{10%,90%{-webkit-transform:translate3d(-1px,0,0) rotate(5deg);-ms-transform:translate3d(-1px,0,0) rotate(5deg);transform:translate3d(-1px,0,0) rotate(5deg);}20%,80%{-webkit-transform:translate3d(2px,0,0);-ms-transform:translate3d(2px,0,0);transform:translate3d(2px,0,0);}30%,50%,70%{-webkit-transform:translate3d(-2px,0,0) rotate(-5deg);-ms-transform:translate3d(-2px,0,0) rotate(-5deg);transform:translate3d(-2px,0,0) rotate(-5deg);}40%,60%{-webkit-transform:translate3d(2px,0,0);-ms-transform:translate3d(2px,0,0);transform:translate3d(2px,0,0);}}
/* sc-component-id: sc-keyframes-imEtRc */
@-webkit-keyframes imEtRc{to{-webkit-transform:translateY(0);-ms-transform:translateY(0);transform:translateY(0);opacity:1;}}@keyframes imEtRc{to{-webkit-transform:translateY(0);-ms-transform:translateY(0);transform:translateY(0);opacity:1;}}
/* sc-component-id: sc-gZMcBi */

.jpQFXF{height:15vh;background-color:#ffa81f;color:blue;position:fixed;top:0;right:0;left:0;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;background:linear-gradient(#ffa81f,#d85d15);background-size:250% 250%;-webkit-animation:kKvztC 10s ease infinite;animation:kKvztC 10s ease infinite;font-weight:400;-webkit-transition:height 250ms ease-in-out;transition:height 250ms ease-in-out;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;}@media only screen and (min-width:768px){.jpQFXF{height:30vh;}}
/* sc-component-id: sc-gqjmRU */

.iuAhMc{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;font-size:2rem;text-transform:uppercase;font-weight:700;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-transition:font-size 250ms ease-in-out,padding 150ms ease-in;transition:font-size 250ms ease-in-out,padding 150ms ease-in;background-color:#002635;color:white;padding:0.5rem 1rem;margin:0;width:auto;-webkit-user-select:text;-moz-user-select:text;-ms-user-select:text;user-select:text;}.wf-active .iuAhMc{font-family:'Montserrat',sans-serif;}@media only screen and (min-width:375px){.iuAhMc{font-size:2.5rem;}}@media only screen and (min-width:768px){.iuAhMc{font-size:4.5rem;padding:1rem 2rem;}}
/* sc-component-id: sc-VigVT */

.gTXDNM{display:inline-block;position:relative;z-index:3;}.gTXDNM:hover{-webkit-animation:lisfJs 1000ms ease-in-out;animation:lisfJs 1000ms ease-in-out;}
/* sc-component-id: sc-jTzLTM */

.clHDjp{padding-right:2vw;font-weight:700;white-space:nowrap;}
/* sc-component-id: sc-fjdhpX */

.fYeLTY{font-weight:400;white-space:nowrap;}
/* sc-component-id: sc-jzJRlG */

.fjcXyM{color:inherit;}
/* sc-component-id: sc-kAzzGY */

.eTzlhe{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;height:100%;}
/* sc-component-id: sc-chPdSV */

.fSEAnG{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;width:100%;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;z-index:1;background:hsl(17,90%,20%);color:white;position:relative;padding-top:1.5rem;padding-bottom:2.25rem;-webkit-transition:background-color 125ms ease-in-out;transition:background-color 125ms ease-in-out;}@media only screen and (min-width:768px){.fSEAnG{padding:2.625rem 0;}}
/* sc-component-id: sc-kgoBCf */

.hpPTKp{display:block;margin:0;font-size:1.5rem;line-height:2.25rem;}@media only screen and (min-width:768px){.hpPTKp{padding:0.75rem 0;border-top:4px solid #fff;border-bottom:4px solid #fff;font-size:2.25rem;line-height:3rem;}}
/* sc-component-id: sc-kpOJdX */

.krhCRj{position:absolute;bottom:8px;left:50%;-webkit-transform:translateX(-50%);-ms-transform:translateX(-50%);transform:translateX(-50%);margin:0;padding:0;color:rgba(255,255,255,0.9);font-size:1.125rem;font-weight:400;z-index:2;}
/* sc-component-id: sc-dxgOiQ */

.dqfGXQ{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;padding-bottom:0.375rem;}
/* sc-component-id: sc-ckVGcZ */

.fwtlwV{display:inline-block;background-color:white;padding:0.5rem 1.5rem;font-size:1.125rem;font-weight:bold;-webkit-text-decoration:none;text-decoration:none;text-align:center;text-transform:uppercase;border-width:2px;border-style:solid;-webkit-transition:all 125ms ease-in-out;transition:all 125ms ease-in-out;font-family:sans-serif;background-color:hsl(17,90%,20%);color:white;border-color:hsl(17,90%,20%);}.fwtlwV:hover{color:hsl(17,90%,20%);background-color:white;}
</style><style type="text/css" data-styled-components="" data-styled-components-is-local="false">/* sc-component-id: sc-global-367058698 */
h1.post-title{text-align:center;font-weight:700;display:inline-block;}.post-content h2{color:#333;margin:0.375rem 0;padding:0.375rem 0;border-bottom:2px solid #ddd;font-weight:400;}.post-content h3{display:inline-block;color:#444;margin:0.25rem 0;padding:0.25rem;padding-left:0;border-bottom:1px solid #ddd;font-weight:400;}.post-content p{margin:1.125rem auto;color:#333;line-height:1.875rem;}
</style><style type="text/css" data-styled-components="hSXAic cVmumm ICZsf gSdWKa dVEktx iHsYxQ" data-styled-components-is-local="true">/* sc-component-id: sc-jKJlTe */

.cVmumm{position:relative;width:100%;background-color:white;box-shadow:0 0 4px 1px rgba(0,0,0,.2);background-color:white;outline:1px solid rgba(0,0,0,0.125);box-shadow:0 0 4px 1px rgba(0,0,0,.2);box-sizing:border-box;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;padding-bottom:1.5rem;}.cVmumm:last-child{border-bottom-width:0;}@media only screen and (min-width:768px){.cVmumm{margin-bottom:0;padding-bottom:3rem;}}
/* sc-component-id: sc-eNQAEJ */

.ICZsf{max-width:100%;padding:1.125rem 1.5rem;}@media only screen and (min-width:768px){.ICZsf{padding:1.5rem 3rem;padding-top:1.5rem;}}
/* sc-component-id: sc-hMqMXs */

.gSdWKa{border:0;width:75%;margin:0.75rem auto;border-bottom:1px solid #eee;}
/* sc-component-id: sc-kEYyzF */

.iHsYxQ{font-size:32px;margin-right:0.5rem;}
/* sc-component-id: sc-kkGfuU */

.dVEktx{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;}
/* sc-component-id: sc-Rmtcm */

.hSXAic{max-width:100%;-webkit-transform:translateY(16px) scale(.99);-ms-transform:translateY(16px) scale(.99);transform:translateY(16px) scale(.99);-webkit-transform-origin:50% 0;-ms-transform-origin:50% 0;transform-origin:50% 0;opacity:0;-webkit-animation:imEtRc 0.3s cubic-bezier(.39,.575,.565,1) both;animation:imEtRc 0.3s cubic-bezier(.39,.575,.565,1) both;}
</style><link rel="manifest" href="/manifest.json"/><meta name="theme-color" content="#002635"/><style type="text/css">
    .anchor {
      float: left;
      padding-right: 4px;
      margin-left: -20px;
    }
    h1 .anchor svg,
    h2 .anchor svg,
    h3 .anchor svg,
    h4 .anchor svg,
    h5 .anchor svg,
    h6 .anchor svg {
      visibility: hidden;
    }
    h1:hover .anchor svg,
    h2:hover .anchor svg,
    h3:hover .anchor svg,
    h4:hover .anchor svg,
    h5:hover .anchor svg,
    h6:hover .anchor svg {
      visibility: visible;
    }
  </style><script>
    document.addEventListener("DOMContentLoaded", function(event) {
      var hash = window.decodeURI(location.hash.replace('#', ''))
      if (hash !== '') {
        var element = document.getElementById(hash)
        if (element) {
          var offset = element.offsetTop
          // Wait for the browser to finish rendering before scrolling.
          setTimeout((function() {
            window.scrollTo(0, offset - 0)
          }), 0)
        }
      }
    })
  </script><title data-react-helmet="true">Rui Oliveira - Designing an Api Gateway with authentication and authorization</title><meta data-react-helmet="true" name="keywords" content="rui, oliveira, scala, java, jvm, architecture, software"/><meta data-react-helmet="true" name="description" content="Motivation Authentication and authorization may be a problem in a micro service environment. 
If every micro service has its own authentication and…"/><meta data-react-helmet="true" name="og:description" content="Motivation Authentication and authorization may be a problem in a micro service environment. 
If every micro service has its own authentication and…"/><meta data-react-helmet="true" name="twitter:description" content="Motivation Authentication and authorization may be a problem in a micro service environment. 
If every micro service has its own authentication and…"/><meta data-react-helmet="true" name="og:title" content="Designing an Api Gateway with authentication and authorization"/><meta data-react-helmet="true" name="og:type" content="article"/><meta data-react-helmet="true" name="article:author" content="Rui Oliveiras"/><meta data-react-helmet="true" name="twitter:creator" content="ruioliveira"/><meta data-react-helmet="true" name="author" content="Rui Oliveiras"/><meta data-react-helmet="true" name="twitter:label1" content="Reading time"/><meta data-react-helmet="true" name="twitter:data1" content="6 min read"/><meta data-react-helmet="true" name="article:published_time" content="2018-02-15T23:36:56.503Z"/><link rel="alternate" type="application/rss+xml" href="/rss.xml"/><style id="typography.js">html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}body{margin:0}article,aside,details,figcaption,figure,footer,header,main,menu,nav,section,summary{display:block}audio,canvas,progress,video{display:inline-block}audio:not([controls]){display:none;height:0}progress{vertical-align:baseline}[hidden],template{display:none}a{background-color:transparent;-webkit-text-decoration-skip:objects}a:active,a:hover{outline-width:0}abbr[title]{border-bottom:none;text-decoration:underline;text-decoration:underline dotted}b,strong{font-weight:inherit;font-weight:bolder}dfn{font-style:italic}h1{font-size:2em;margin:.67em 0}mark{background-color:#ff0;color:#000}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}img{border-style:none}svg:not(:root){overflow:hidden}code,kbd,pre,samp{font-family:monospace,monospace;font-size:1em}figure{margin:1em 40px}hr{box-sizing:content-box;height:0;overflow:visible}button,input,optgroup,select,textarea{font:inherit;margin:0}optgroup{font-weight:700}button,input{overflow:visible}button,select{text-transform:none}[type=reset],[type=submit],button,html [type=button]{-webkit-appearance:button}[type=button]::-moz-focus-inner,[type=reset]::-moz-focus-inner,[type=submit]::-moz-focus-inner,button::-moz-focus-inner{border-style:none;padding:0}[type=button]:-moz-focusring,[type=reset]:-moz-focusring,[type=submit]:-moz-focusring,button:-moz-focusring{outline:1px dotted ButtonText}fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}legend{box-sizing:border-box;color:inherit;display:table;max-width:100%;padding:0;white-space:normal}textarea{overflow:auto}[type=checkbox],[type=radio]{box-sizing:border-box;padding:0}[type=number]::-webkit-inner-spin-button,[type=number]::-webkit-outer-spin-button{height:auto}[type=search]{-webkit-appearance:textfield;outline-offset:-2px}[type=search]::-webkit-search-cancel-button,[type=search]::-webkit-search-decoration{-webkit-appearance:none}::-webkit-input-placeholder{color:inherit;opacity:.54}::-webkit-file-upload-button{-webkit-appearance:button;font:inherit}html{font:112.5%/1.5 'georgia',serif;box-sizing:border-box;overflow-y:scroll;}*{box-sizing:inherit;}*:before{box-sizing:inherit;}*:after{box-sizing:inherit;}body{color:hsla(0,0%,0%,0.8);font-family:'georgia',serif;font-weight:normal;word-wrap:break-word;font-kerning:normal;-moz-font-feature-settings:"kern", "liga", "clig", "calt";-ms-font-feature-settings:"kern", "liga", "clig", "calt";-webkit-font-feature-settings:"kern", "liga", "clig", "calt";font-feature-settings:"kern", "liga", "clig", "calt";}img{max-width:100%;margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.5rem;}h1{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.5rem;color:inherit;font-family:-apple-system,'BlinkMacSystemFont','Segoe UI','Roboto','Oxygen','Ubuntu','Cantarell','Fira Sans','Droid Sans','Helvetica Neue',sans-serif;font-weight:bold;text-rendering:optimizeLegibility;font-size:2.25rem;line-height:1.1;}h2{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.5rem;color:inherit;font-family:-apple-system,'BlinkMacSystemFont','Segoe UI','Roboto','Oxygen','Ubuntu','Cantarell','Fira Sans','Droid Sans','Helvetica Neue',sans-serif;font-weight:bold;text-rendering:optimizeLegibility;font-size:1.62671rem;line-height:1.1;}h3{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.5rem;color:inherit;font-family:-apple-system,'BlinkMacSystemFont','Segoe UI','Roboto','Oxygen','Ubuntu','Cantarell','Fira Sans','Droid Sans','Helvetica Neue',sans-serif;font-weight:bold;text-rendering:optimizeLegibility;font-size:1.38316rem;line-height:1.1;}h4{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.5rem;color:inherit;font-family:-apple-system,'BlinkMacSystemFont','Segoe UI','Roboto','Oxygen','Ubuntu','Cantarell','Fira Sans','Droid Sans','Helvetica Neue',sans-serif;font-weight:bold;text-rendering:optimizeLegibility;font-size:1rem;line-height:1.1;}h5{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.5rem;color:inherit;font-family:-apple-system,'BlinkMacSystemFont','Segoe UI','Roboto','Oxygen','Ubuntu','Cantarell','Fira Sans','Droid Sans','Helvetica Neue',sans-serif;font-weight:bold;text-rendering:optimizeLegibility;font-size:0.85028rem;line-height:1.1;}h6{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.5rem;color:inherit;font-family:-apple-system,'BlinkMacSystemFont','Segoe UI','Roboto','Oxygen','Ubuntu','Cantarell','Fira Sans','Droid Sans','Helvetica Neue',sans-serif;font-weight:bold;text-rendering:optimizeLegibility;font-size:0.78405rem;line-height:1.1;}hgroup{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.5rem;}ul{margin-left:1.5rem;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.5rem;list-style-position:outside;list-style-image:none;}ol{margin-left:1.5rem;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.5rem;list-style-position:outside;list-style-image:none;}dl{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.5rem;}dd{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.5rem;}p{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.5rem;}figure{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.5rem;}pre{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.5rem;font-size:0.85rem;line-height:1.42;background:hsla(0,0%,0%,0.04);border-radius:3px;overflow:auto;word-wrap:normal;padding:1.5rem;}table{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.5rem;font-size:1rem;line-height:1.5rem;border-collapse:collapse;width:100%;}fieldset{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.5rem;}blockquote{margin-left:1.5rem;margin-right:1.5rem;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.5rem;}form{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.5rem;}noscript{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.5rem;}iframe{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.5rem;}hr{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:calc(1.5rem - 1px);background:hsla(0,0%,0%,0.2);border:none;height:1px;}address{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.5rem;}b{font-weight:bold;}strong{font-weight:bold;}dt{font-weight:bold;}th{font-weight:bold;}li{margin-bottom:calc(1.5rem / 2);}ol li{padding-left:0;}ul li{padding-left:0;}li > ol{margin-left:1.5rem;margin-bottom:calc(1.5rem / 2);margin-top:calc(1.5rem / 2);}li > ul{margin-left:1.5rem;margin-bottom:calc(1.5rem / 2);margin-top:calc(1.5rem / 2);}blockquote *:last-child{margin-bottom:0;}li *:last-child{margin-bottom:0;}p *:last-child{margin-bottom:0;}li > p{margin-bottom:calc(1.5rem / 2);}code{font-size:0.85rem;line-height:1.5rem;}kbd{font-size:0.85rem;line-height:1.5rem;}samp{font-size:0.85rem;line-height:1.5rem;}abbr{border-bottom:1px dotted hsla(0,0%,0%,0.5);cursor:help;}acronym{border-bottom:1px dotted hsla(0,0%,0%,0.5);cursor:help;}abbr[title]{border-bottom:1px dotted hsla(0,0%,0%,0.5);cursor:help;text-decoration:none;}thead{text-align:left;}td,th{text-align:left;border-bottom:1px solid hsla(0,0%,0%,0.12);font-feature-settings:"tnum";-moz-font-feature-settings:"tnum";-ms-font-feature-settings:"tnum";-webkit-font-feature-settings:"tnum";padding-left:1rem;padding-right:1rem;padding-top:0.75rem;padding-bottom:calc(0.75rem - 1px);}th:first-child,td:first-child{padding-left:0;}th:last-child,td:last-child{padding-right:0;}tt,code{background-color:hsla(0,0%,0%,0.04);border-radius:3px;font-family:"SFMono-Regular", Consolas,"Roboto Mono","Droid Sans Mono","Liberation Mono",Menlo,Courier,monospace;padding:0;padding-top:0.2em;padding-bottom:0.2em;}pre code{background:none;line-height:1.42;}code:before,code:after,tt:before,tt:after{letter-spacing:-0.2em;content:" ";}pre code:before,pre code:after,pre tt:before,pre tt:after{content:none;}@media only screen and (max-width:480px){html{font-size:100%;}}</style><style>.particles-js-canvas-el{position:absolute;top:0;right:0;bottom:0;left:0}#___gatsby,body,html{height:100%}body{background-color:#002635}::-moz-selection{background:#ff6138;color:#fff}::selection{background:#ff6138;color:#fff}.gatsby-highlight-code-line{background-color:#444;display:block;margin-right:-1em;margin-left:-1em;padding-right:1em;padding-left:.75em;border-left:.25em solid #66d9ef}.gatsby-highlight{background-color:#272822;border-radius:.3em;margin:.5em 0;padding:1em;overflow:auto}.gatsby-highlight pre[class*=language-]{background-color:transparent;margin:0;padding:0;overflow:visible;overflow:initial;float:left;min-width:100%}.gatsby-resp-image-wrapper{z-index:1!important}.wf-active .post h1{font-family:Bitter,Georgia,serif}.post h1,.post h2,.post h3,.post h4,.post h5{font-family:Georgia,serif;letter-spacing:.6px;word-spacing:0}.post-content a:not(.anchor){display:inline;color:#d85d15;position:relative;text-decoration:none;padding:2px;transition:all 175ms ease-in-out}.post-content a:after,.post-content a:before{content:"";position:absolute;left:0;right:0;width:100%;height:1px;background-color:#d85d15}.post-content a:hover{background-color:rgba(216,93,21,.05)}.post-content a:after{bottom:-2px;transition:.2s ease-out}.post-content a:before{top:-2px;-ms-transform:translateY(24px);transform:translateY(24px);opacity:0;transition:.2s ease-out}.post-content a:hover:before{-ms-transform-origin:center top;transform-origin:center top;-ms-transform:translateY(0) scaleX(1.025);transform:translateY(0) scaleX(1.025);opacity:1}.post-content a:hover:after{-ms-transform-origin:center bottom;transform-origin:center bottom;-ms-transform:scaleX(1.025);transform:scaleX(1.025)}.post-content blockquote{margin-left:.75rem;padding-left:1.5rem;border-left:4px solid #ddd}.post-content video.responsive{max-width:100%;max-height:100%}code[class*=language-],pre[class*=language-]{color:#f8f8f2;background:none;text-shadow:0 1px rgba(0,0,0,.3);font-family:Consolas,Monaco,Andale Mono,Ubuntu Mono,monospace;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-ms-hyphens:none;hyphens:none}pre[class*=language-]{padding:1em;margin:.5em 0;overflow:auto;border-radius:.3em}:not(pre)>code[class*=language-],pre[class*=language-]{background:#272822}:not(pre)>code[class*=language-]{padding:.1em;border-radius:.3em;white-space:normal}.token.cdata,.token.comment,.token.doctype,.token.prolog{color:#708090}.token.punctuation{color:#f8f8f2}.namespace{opacity:.7}.token.constant,.token.deleted,.token.property,.token.symbol,.token.tag{color:#f92672}.token.boolean,.token.number{color:#ae81ff}.token.attr-name,.token.builtin,.token.char,.token.inserted,.token.selector,.token.string{color:#a6e22e}.language-css .token.string,.style .token.string,.token.entity,.token.operator,.token.url,.token.variable{color:#f8f8f2}.token.atrule,.token.attr-value,.token.function{color:#e6db74}.token.keyword{color:#66d9ef}.token.important,.token.regex{color:#fd971f}.token.bold,.token.important{font-weight:700}.token.italic{font-style:italic}.token.entity{cursor:help}</style></head><body><div id="___gatsby"><div class="sc-kAzzGY eTzlhe" data-reactroot=""><header class="sc-gZMcBi jpQFXF" id="blog-header"><h1 class="name sc-gqjmRU iuAhMc"><a class="sc-jzJRlG fjcXyM" href="/"><span class="sc-jTzLTM clHDjp"><span class="sc-VigVT gTXDNM">R</span><span class="sc-VigVT gTXDNM">u</span><span class="sc-VigVT gTXDNM">i</span></span><span class="sc-fjdhpX fYeLTY"><span class="sc-VigVT gTXDNM">O</span><span class="sc-VigVT gTXDNM">l</span><span class="sc-VigVT gTXDNM">i</span><span class="sc-VigVT gTXDNM">v</span><span class="sc-VigVT gTXDNM">e</span><span class="sc-VigVT gTXDNM">i</span><span class="sc-VigVT gTXDNM">r</span><span class="sc-VigVT gTXDNM">a</span></span></a></h1></header><main class="sc-bdVaJa jhBgmt"><div class="sc-Rmtcm hSXAic"><section class="post blog-post sc-jKJlTe cVmumm"><div class="sc-chPdSV fSEAnG" title="Designing an Api Gateway with authentication and authorization"><h1 class="post-title sc-kgoBCf hpPTKp">Designing an Api Gateway with authentication and authorization</h1><div class="sc-dxgOiQ dqfGXQ"><div><a class="sc-gzVnrw iwNQwu sc-EHOje gDhWkp" title="Designing an Api Gateway with authentication and authorization" href="/java9-overview"><svg fill="currentColor" preserveAspectRatio="xMidYMid meet" height="1em" width="1em" viewBox="0 0 40 40" class="icon" style="vertical-align:middle"><g><path d="m31.1 6.7l-11.8 11.9 11.8 11.8q0.5 0.4 0.5 1t-0.5 1l-3.7 3.7q-0.4 0.5-1 0.5t-1-0.5l-16.5-16.5q-0.5-0.4-0.5-1t0.5-1l16.5-16.6q0.5-0.4 1-0.4t1 0.4l3.7 3.7q0.5 0.4 0.5 1t-0.5 1z"></path></g></svg><span class="content">Java 9 Overview</span></a></div><h2 class="sc-kpOJdX krhCRj">February 15, 2018</h2></div></div><div class="sc-eNQAEJ ICZsf"><div class="post-content"><h2 id="motivation"><a href="#motivation" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Motivation</h2>
<p>Authentication and authorization may be a problem in a micro service environment.
If every micro service has its own authentication and authorization, you end up
with multiple services doing the same thing, and perhaps with different implementations.</p>
<p>The cleanest way of doing it is with a service dedicated to authentication and authorization, I’m going to call this service the <strong>bouncer service</strong>.</p>
<p><strong>Abstract:</strong></p>
<ol>
<li><a href="#concept-map">Concept map - the problem domain</a></li>
<li>
<p><a href="#high-level-implementation">High level implementation</a></p>
<ol>
<li><a href="#problems">Identified implementation problems</a></li>
</ol>
</li>
<li>
<p><a href="#implemetation">Implementation</a></p>
<ol>
<li><a href="#flow-new-request-comes"> Flow: new ‘http request’ comes</a></li>
<li><a href="#new-micro-service"> Registration of a new micro-service</a></li>
<li><a href="#extract-auth-resource"> Extract ‘auth resources’ from http request</a></li>
<li><a href="#data-storage"> Store data in Couchbase</a></li>
<li><a href="#care-about-your-developer">Easy to use in Development Environment</a></li>
</ol>
</li>
</ol>
<p><a name="concept-map"></a></p>
<h2 id="concept-map---the-problem-domain"><a href="#concept-map---the-problem-domain" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Concept map - the problem domain</h2>
<p>
  <span
    class="gatsby-resp-image-wrapper"
    style="position: relative; display: block; ; max-width: 650px; margin-left: auto; margin-right: auto;"
  >
    <span
      class="gatsby-resp-image-background-image"
      style="padding-bottom: 46.324549237170594%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAIAAAC9o5sfAAAACXBIWXMAAAsSAAALEgHS3X78AAAA+klEQVQoz3WRyW6EMBBE/f//xyUjgQCbTeCFHUNCnrAGRdFQB2O3q11VjaiqKkmS1+ur67p1XbcL8zxrrbM8S9NsGAbv/foHP2+Itm37vjfGTNP0/cZxHJCstVzxFpXAPs8zHM8LwjnHJ1z8A5pQw35ZFryUZSmVVErh11r3uZkjVpWSdV1vm0fK9U7rLs+zOImlzHloP47PzbCJbbTBOXHQN1oTDf2iUGQJzh9t796naVoUJRYCgZ4kiaMoimPEJeKC0lPm+QLNKDM/LDRNQxB7gaIgOhf4gXRPe993KuM40sz+fIBggDxJP9QgwkoFR2G9Bx4M3v8M/AITPQhAf/2vVQAAAABJRU5ErkJggg=='); background-size: cover; display: block;"
    >
      <img
        class="gatsby-resp-image-image"
        style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;"
        alt="text"
        title=""
        src="/static/domain-diagram-b9c59f26524b5be82f676d8953e90f72-83a8b.png"
        srcset="/static/domain-diagram-b9c59f26524b5be82f676d8953e90f72-8992e.png 163w,
/static/domain-diagram-b9c59f26524b5be82f676d8953e90f72-ae0a7.png 325w,
/static/domain-diagram-b9c59f26524b5be82f676d8953e90f72-83a8b.png 650w,
/static/domain-diagram-b9c59f26524b5be82f676d8953e90f72-28f5c.png 721w"
        sizes="(max-width: 650px) 100vw, 650px"
      />
    </span>
  </span>
  </p>
<p>Example of instantiation:</p>
<ul>
<li><strong>Resource1</strong></li>
<li><strong>Resource2</strong> with levels: admin, lvl1, actions, reports</li>
<li><strong>Role1</strong> has Resource1, resource2(lvl1)</li>
<li><strong>Role2</strong> has Resource1, resource2(lvl1, reports)</li>
<li><strong>Role3</strong> has Resource1, resource2(lvl1, actions)</li>
<li><strong>Role4</strong> has Resource1, resource2(admin)</li>
<li><strong>User1</strong> has role2</li>
<li><strong>User2</strong> has role3</li>
<li><strong>User3</strong> has role2 and role3</li>
</ul>
<p>The <strong>user3</strong> has the resource2 with levels lv1, actions and reports</p>
<p><a name="high-level-implementation"></a></p>
<h2 id="high-level-implementation"><a href="#high-level-implementation" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>High level implementation</h2>
<p>
  <span
    class="gatsby-resp-image-wrapper"
    style="position: relative; display: block; ; max-width: 650px; margin-left: auto; margin-right: auto;"
  >
    <span
      class="gatsby-resp-image-background-image"
      style="padding-bottom: 48.0392156862745%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAIAAAA7N+mxAAAACXBIWXMAAAsSAAALEgHS3X78AAABOUlEQVQoz1WS2ZKCMBBF/f+vG30RQWsYBwwmLCFRQBaZQ1LKeB9STbpPL2k25/PZGPN4PNq25ayqSimV5zmGNQYjd5/W2qIocietNZHzPG+4HccR6/l8csJkWQav65p0Ssp3tNZLXgQyO2085oXd9/3tpQVW6urka5ZlSaVpmlb4v/D5lianruuEuERRdDqdwjBM03QYRl9mgQnFnS66MBM+D/uIpmn6fvBJ6cVaQ8/3+32tXGud/CZx/ENXtOpHAmYEGHjSDcOANwgC6pPlo23c70ngIcGOx2i3RV+77a4sKxgpJc/2UZnoSmuueiftbGBs1iPl1RiLLYQID4f4O6aFFSafyIRSkg7LomBVFyHabll7ucCSaF7O1LV0m/OPslb2YjD/t5DFr6RxarsOV5IkexTsb6+2/wDrDzseazjZ5gAAAABJRU5ErkJggg=='); background-size: cover; display: block;"
    >
      <img
        class="gatsby-resp-image-image"
        style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;"
        alt="text2"
        title=""
        src="/static/high-level-c4bcd4736c2379945f3239a932bd89af-83a8b.png"
        srcset="/static/high-level-c4bcd4736c2379945f3239a932bd89af-8992e.png 163w,
/static/high-level-c4bcd4736c2379945f3239a932bd89af-ae0a7.png 325w,
/static/high-level-c4bcd4736c2379945f3239a932bd89af-83a8b.png 650w,
/static/high-level-c4bcd4736c2379945f3239a932bd89af-282b5.png 714w"
        sizes="(max-width: 650px) 100vw, 650px"
      />
    </span>
  </span>
  </p>
<p><a name="problems"></a></p>
<h3 id="identified-implementation-problems"><a href="#identified-implementation-problems" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Identified implementation problems</h3>
<ul>
<li>When we receive an Http Request, what flow should we have ? <a href="#flow-new-request-comes">Answer</a></li>
<li>How can the Bouncer service know all the micro-services and what resources does it have ? <a href="#new-micro-service">Answer</a></li>
<li>How can we extract the required resources from an Http request ? <a href="#extract-auth-resource">Answer</a></li>
<li>How can we store our data model ? <a href="#data-storage">Answer</a></li>
<li>Should the micro services communicate between than ? Or should they use the Service Bouncer? To be answered in the future post!</li>
<li>Forcing differents teams, perhaps with different technologies, to use the Service bouncer may be a problem. What care should we take to be easy to use in development environment? <a href="#care-about-your-developer">Answer</a></li>
</ul>
<p><a name="implementation"></a></p>
<h2 id="implementation"><a href="#implementation" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Implementation</h2>
<p><a name="flow-new-request-comes"></a></p>
<h3 id="flow-new-request-comes"><a href="#flow-new-request-comes" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Flow new request comes</h3>
<ol>
<li>The request arrives to the system</li>
<li>The request is <strong>authenticated</strong> (convert the jwt, into the user)    </li>
<li>The http path is processed to:
1. Extract the micro service we want to reach.
2. <a href="#extract-auth-resource">Extract the resource in that request</a> we want to use.</li>
<li>We know the user, the micro-service and the resource.</li>
<li>Now we can process all the information to perform <strong>Authorization</strong>
1.1. The answer could be negative
1.2. Or Positive
1.2. Or Positive, but with conditions (levels of access)  </li>
<li>The request is forwarded to the micro service, with levels of access.</li>
</ol>
<p><a name="new-micro-service"></a></p>
<h3 id="registration-of-a-new-micro-service"><a href="#registration-of-a-new-micro-service" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Registration of a new micro-service</h3>
<ol>
<li>When a new micro service launches, it should have a configured end point to reach the bouncer service.</li>
<li>And the new micro service will send, to the bouncer service, something like this to register itself: </li>
</ol>
<div class="gatsby-highlight">
      <pre class="language-json"><code><span class="token punctuation">{</span>
   <span class="token property">"name"</span><span class="token operator">:</span><span class="token string">"name-of-example1"</span><span class="token punctuation">,</span>
   <span class="token property">"version"</span><span class="token operator">:</span><span class="token string">"v0.0.1"</span><span class="token punctuation">,</span>
   <span class="token property">"forwardHost"</span><span class="token operator">:</span><span class="token string">"api-internal.example1.com"</span><span class="token punctuation">,</span>
   <span class="token property">"paths"</span><span class="token operator">:</span><span class="token punctuation">{</span>
	 <span class="token property">"GET:/path1/"</span> <span class="token operator">:</span> <span class="token punctuation">{</span>
	 	<span class="token property">"require"</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token string">"resource1"</span><span class="token punctuation">]</span>
	 <span class="token punctuation">}</span><span class="token punctuation">,</span>
	 <span class="token property">"POST:/path1/"</span> <span class="token operator">:</span> <span class="token punctuation">{</span>
	 	<span class="token property">"require"</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token string">"resource1"</span><span class="token punctuation">]</span>
	 <span class="token punctuation">}</span><span class="token punctuation">,</span>
	 <span class="token property">"GET:/path1/:ID"</span> <span class="token operator">:</span> <span class="token punctuation">{</span>
	 	<span class="token property">"require"</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token string">"resource1"</span><span class="token punctuation">,</span> <span class="token string">"resource2"</span><span class="token punctuation">]</span>
	 <span class="token punctuation">}</span>
   <span class="token punctuation">}</span><span class="token punctuation">,</span>
   <span class="token property">"resources"</span><span class="token operator">:</span><span class="token punctuation">[</span>
   	 <span class="token punctuation">{</span><span class="token property">"code"</span><span class="token operator">:</span><span class="token string">"resource1"</span><span class="token punctuation">,</span> <span class="token property">"levels"</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token string">"level1"</span><span class="token punctuation">,</span> <span class="token string">"level2"</span><span class="token punctuation">,</span> <span class="token string">"level3"</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
   	 <span class="token punctuation">{</span><span class="token property">"code"</span><span class="token operator">:</span><span class="token string">"resource2"</span><span class="token punctuation">}</span>
   <span class="token punctuation">]</span>

<span class="token punctuation">}</span>
</code></pre>
      </div>
<p>With the version it should be possible to <strong>run multiple versions at a time</strong>, and the bouncer service could have special behaviours to handle multiple versions. This feature could facilitate <a href="https://martinfowler.com/bliki/BlueGreenDeployment.html">blue-green deploys</a>. </p>
<p>All paths are declared and mapped to resources. So that, when the service bouncer receives the request:
<code>GET &#x3C;host>/path1/125</code> it knows that it <strong>requires</strong>: <code>resource1</code> and <code>resource2</code>.
So it will search if the authorized user has access it.</p>
<ul>
<li>if the user doesn’t have access to it, the request will not be forwarded.</li>
<li>if the user has access to it, the request will be forwarded, adding in to the http headers the <em>level</em> of resource1. </li>
</ul>
<p><a name="extract-auth-resource"></a></p>
<h3 id="extract-auth-resources-from-http-request"><a href="#extract-auth-resources-from-http-request" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Extract ‘auth resources’ from http request</h3>
<p>The service bouncer could create a suffix tree of all paths in the infrastructure, <a href="https://en.wikipedia.org/wiki/Suffix_tree">Suffix tree</a>.</p>
<p>Something like this:</p>
<div class="gatsby-highlight">
      <pre class="language-none"><code>"path1/"
   -> <endPath> 
          -> GET  {fullPath: GET:path1, requires:["resource1"]}
   -> <endPath> 
           -> POST {fullPath: POST:path1, requires:["resource1"]}
   -> <anyIntValue> 
          -> <endPath> 
                 -> GET {fullPpath: POST:path1/:id, requires:["resource1", "resource2"]}</code></pre>
      </div>
<p>The information stored in the leaf of that tree could store the required <strong>resources</strong>.</p>
<p>Knowing this, the Bouncer service will extract from the http headers the resources it requires.
The Http request will only be forwarded to the micro service if the actual user has access to the resources. </p>
<p><a name="data-storage"></a></p>
<h3 id="store-data-in-couchbase"><a href="#store-data-in-couchbase" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Store data in Couchbase</h3>
<ol>
<li>
<p>First authentication:
The request will arrive to the Bouncer Service with a <a href="https://jwt.io/introduction/">Json web token (JWT)</a>.
Using the secret we will guarantee that it is a valid token.
OR
We could use the old fashioned RANDOM TOKEN that maps the database to the userId.</p>
</li>
<li>
<p>After having a valid user id, we can search in the couchbase for the key <code>p:$user1</code></p>
</li>
<li>
<p>Now we search all the roles of that user, example <code>r:role1</code> and <code>r:role2</code></p>
</li>
<li>
<p>Then we know all the resources and levels for that user.</p>
</li>
<li>
<p>Since the resource was already <a href="#extract-auth-resource">parsed bellow</a>,
we know everything to authorize and forward this request.   </p>
</li>
</ol>
<h4 id="couchbase-keys"><a href="#couchbase-keys" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Couchbase keys</h4>
<div class="gatsby-highlight">
      <pre class="language-none"><code>p:$userId => {"roles":["role1", "role2"]}

r:$roleCode => {"resources":{"resource1":{"with":["level1"]}, "resource2":{}}}</code></pre>
      </div>
<p><a name="care-about-your-developer"></a></p>
<h3 id="easy-to-use-in-development-environment"><a href="#easy-to-use-in-development-environment" aria-hidden="true" class="anchor"><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Easy to use in Development Environment</h3>
<p>There are multiple differents things to do:</p>
<ul>
<li>Distribute the Service Bouncer inside a docker (You can use also have the couchbase inside a docker).</li>
<li>Have SDK for your different languages</li>
<li>Create good error messages, that can provide you real information.</li>
</ul>
<p>It is not difficult to create easy to use systems, but you should keep this in mind when you build something that is going to be used by multiples teams.</p></div><hr class="sc-hMqMXs gSdWKa"/></div><a class="sc-ckVGcZ fwtlwV" title="Designing an Api Gateway with authentication and authorization" href="/"><span class="sc-kkGfuU dVEktx"><svg fill="currentColor" preserveAspectRatio="xMidYMid meet" height="1em" width="1em" viewBox="0 0 40 40" class="sc-kEYyzF iHsYxQ" style="vertical-align:middle"><g><path d="m11.6 11.6h23.4v3.4h-23.4v-3.4z m0 16.8v-3.4h23.4v3.4h-23.4z m0-6.8v-3.2h23.4v3.2h-23.4z m-6.6-6.6v-3.4h3.4v3.4h-3.4z m0 13.4v-3.4h3.4v3.4h-3.4z m0-6.8v-3.2h3.4v3.2h-3.4z"></path></g></svg>All posts</span></a></section></div><footer class="sc-ifAKCX SZdRx"><div class="sc-bxivhb jCCrki" width="240px" color="rgba(255, 255, 255, 0.6)"><div class="button sc-bwzfXH kulSxP" width="240px" color="rgba(255, 255, 255, 0.6)"><a class="button sc-htpNat infYH" target="_blank" rel="noopener" href="https://github.com/ruioliveiras" width="240px" color="rgba(255, 255, 255, 0.6)"><svg fill="currentColor" preserveAspectRatio="xMidYMid meet" height="32" width="32" viewBox="0 0 40 40" style="vertical-align:middle"><g><path d="m20.1 2.9q4.7 0 8.6 2.3t6.3 6.2 2.3 8.6q0 5.6-3.3 10.1t-8.4 6.2q-0.6 0.1-0.9-0.2t-0.3-0.7q0 0 0-1.7t0-3q0-2.1-1.2-3.1 1.3-0.2 2.3-0.4t2.1-0.9 1.8-1.5 1.2-2.3 0.5-3.4q0-2.7-1.8-4.6 0.8-2-0.2-4.5-0.6-0.2-1.8 0.2t-2 1l-0.9 0.5q-2-0.6-4.3-0.6t-4.2 0.6q-0.4-0.2-1-0.6t-1.9-0.8-1.9-0.3q-1 2.5-0.1 4.5-1.8 1.9-1.8 4.6 0 1.9 0.5 3.4t1.1 2.3 1.8 1.5 2.1 0.9 2.3 0.4q-0.9 0.8-1.1 2.3-0.4 0.2-1 0.3t-1.3 0.1-1.4-0.5-1.3-1.4q-0.4-0.7-1-1.1t-1.1-0.6l-0.5 0q-0.5 0-0.6 0.1t-0.1 0.2 0.2 0.3 0.2 0.3l0.2 0.1q0.5 0.2 1 0.9t0.7 1.1l0.2 0.5q0.3 0.9 1 1.4t1.5 0.7 1.5 0.1 1.3-0.1l0.5 0q0 0.8 0 1.9t0 1.2q0 0.5-0.3 0.7t-0.9 0.2q-5.2-1.7-8.4-6.2t-3.3-10.1q0-4.7 2.3-8.6t6.2-6.2 8.6-2.3z m-10.6 24.6q0.1-0.2-0.2-0.3-0.2-0.1-0.2 0.1-0.1 0.1 0.1 0.2 0.2 0.2 0.3 0z m0.7 0.7q0.1-0.1-0.1-0.3-0.2-0.2-0.3-0.1-0.2 0.1 0 0.4 0.3 0.2 0.4 0z m0.7 1q0.2-0.1 0-0.4-0.2-0.3-0.4-0.1-0.2 0.1 0 0.4t0.4 0.1z m0.9 1q0.2-0.2-0.1-0.4-0.3-0.3-0.4-0.1-0.2 0.2 0 0.4 0.3 0.3 0.5 0.1z m1.3 0.5q0-0.2-0.3-0.3-0.4-0.1-0.4 0.1t0.2 0.4q0.4 0.1 0.5-0.2z m1.4 0.1q0-0.2-0.4-0.2-0.4 0-0.4 0.2 0 0.3 0.4 0.3 0.4 0 0.4-0.3z m1.3-0.2q-0.1-0.2-0.4-0.2-0.4 0.1-0.3 0.4t0.4 0.1 0.3-0.3z"></path></g></svg></a></div><div class="button sc-bwzfXH kulSxP" width="240px" color="rgba(255, 255, 255, 0.6)"><a class="button sc-htpNat infYH" target="_blank" rel="noopener" href="https://www.instagram.com/ruioliveiras/" width="240px" color="rgba(255, 255, 255, 0.6)"><svg fill="currentColor" preserveAspectRatio="xMidYMid meet" height="32" width="32" viewBox="0 0 40 40" style="vertical-align:middle"><g><path d="m33.4 31.8v-14.4h-3q0.4 1.4 0.4 2.9 0 2.8-1.4 5.2t-3.9 3.7-5.3 1.4q-4.4 0-7.6-3t-3.1-7.3q0-1.5 0.5-2.9h-3.2v14.4q0 0.6 0.4 1t1 0.4h23.8q0.6 0 1-0.4t0.4-1z m-6.3-11.9q0-2.7-2.1-4.7t-4.8-1.9q-2.9 0-4.9 1.9t-2 4.7 2 4.8 4.9 1.9q2.8 0 4.8-1.9t2.1-4.8z m6.3-8v-3.7q0-0.6-0.4-1.1t-1.1-0.4h-3.9q-0.7 0-1.1 0.4t-0.5 1.1v3.7q0 0.6 0.5 1.1t1.1 0.4h3.9q0.6 0 1.1-0.4t0.4-1.1z m3.9-4.6v25.4q0 1.9-1.3 3.1t-3.1 1.3h-25.5q-1.8 0-3.1-1.3t-1.3-3.1v-25.4q0-1.9 1.3-3.1t3.1-1.3h25.5q1.8 0 3.1 1.3t1.3 3.1z"></path></g></svg></a></div><div class="button sc-bwzfXH kulSxP" width="240px" color="rgba(255, 255, 255, 0.6)"><a class="button sc-htpNat infYH" target="_blank" rel="noopener" href="https://www.flickr.com/photos/152270513@N04" width="240px" color="rgba(255, 255, 255, 0.6)"><svg fill="currentColor" preserveAspectRatio="xMidYMid meet" height="32" width="32" viewBox="0 0 40 40" style="vertical-align:middle"><g><path d="m30.9 2.9q2.6 0 4.5 1.8t1.9 4.6v21.4q0 2.7-1.9 4.6t-4.5 1.8h-21.5q-2.6 0-4.5-1.8t-1.9-4.6v-21.4q0-2.7 1.9-4.6t4.5-1.8h21.5z m-12.3 17.1q0-2-1.4-3.3t-3.4-1.4-3.3 1.4-1.4 3.3 1.4 3.3 3.3 1.4 3.4-1.4 1.4-3.3z m12.6 0q0-2-1.4-3.3t-3.4-1.4-3.3 1.4-1.4 3.3 1.4 3.3 3.3 1.4 3.4-1.4 1.4-3.3z"></path></g></svg></a></div></div></footer></main></div></div><script id="webpack-manifest">/*<![CDATA[*/window.webpackManifest={"231608221292675":"app-117f37bcb7fa0dee84f0.js","99219681209289":"component---node-modules-gatsby-plugin-offline-app-shell-js-5c4c5a0f7af9dc69d6d7.js","50739212244294":"component---src-templates-tags-js-0168b5634fa4ca8dd4cc.js","107818501498521":"component---src-templates-blog-post-js-7e8d1359823ed094ecb5.js","162898551421021":"component---src-pages-404-js-4cdb04ff563d109e0831.js","35783957827783":"component---src-pages-index-js-f10154724d596f143704.js","60335399758886":"path----557518bd178906f8d58a.js","210333531512890":"path---offline-plugin-app-shell-fallback-a0e39f21c11f6a62c5ab.js","55702396619907":"path---tags-1bf42bd052c26712efc0.js","236647592180374":"path---tags-scala-java-jvm-7ba6a1c38e55da67089a.js","261462356566171":"path---tags-pinned-07143d34a85338ca17c3.js","280791712670875":"path---example-post-df1c51e7ceed1feb763e.js","242329255839005":"path---web-summit-2016-f70eef40b687f0bc613b.js","12290684833328":"path---jvm-bytecode-5c8ba8f21973665c5725.js","94639164971244":"path---scala-6a9397e7e145b883e8f1.js","273950069227526":"path---about-23ea4316b60c42f7767b.js","77625194191171":"path---java-9-overview-472a091e8b07dd9d4a2a.js","29909625834292":"path---api-gateway-2f381926b7bf16baf43b.js","254022195166212":"path---404-a0e39f21c11f6a62c5ab.js","142629428675168":"path---index-6cb94effddb0efbcbabf.js","178698757827068":"path---404-html-a0e39f21c11f6a62c5ab.js","114276838955818":"component---src-layouts-index-js-346be2a9e8553dce1ede.js","67604419171931":"webfontloader-7e2893ef542a12a5c720.js","16355028499350":"@dschau/particles.js-044bda3a24f6e96d36f1.js"}/*]]>*/</script><script>
  
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-102928446-2', 'auto');
  </script><script>/*<![CDATA[*/!function(e,t,r){function n(){for(;d[0]&&"loaded"==d[0][f];)c=d.shift(),c[o]=!i.parentNode.insertBefore(c,i)}for(var s,a,c,d=[],i=e.scripts[0],o="onreadystatechange",f="readyState";s=r.shift();)a=e.createElement(t),"async"in i?(a.async=!1,e.head.appendChild(a)):i[f]?(d.push(a),a[o]=n):e.write("<"+t+' src="'+s+'" defer></'+t+">"),a.src=s}(document,"script",["/commons-39aa834b3ef8ab6ea859.js","/app-117f37bcb7fa0dee84f0.js","/path---api-gateway-2f381926b7bf16baf43b.js","/component---src-templates-blog-post-js-7e8d1359823ed094ecb5.js","/component---src-layouts-index-js-346be2a9e8553dce1ede.js"])/*]]>*/</script></body></html>